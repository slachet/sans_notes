- Zonetransfer: dump DNS database from DNS server, `type=AXFR`
- Two DNS servers be configured: external and internal
- Zonetransfer must be allowed only by OWN secondary DNS server

## Links

- [SEC Edgar](https://www.xlek.com): Search for information about pulicly traded companies
- [Namechk plugin](https://namechk.com/): Check for names in Social media and domains
- [WhatsMyName Web](https://whatsmyname.app/): Search for a user name in in different services, google search, documents
- [Shodan](https://www.shodan.io/): Proxy scanner
- [DNS Search](https://viewdns.info/)
- [builtwith](https://builtwith.com/): Displays service providers' information from domain.
- [EyeWitness](https://github.com/RedSiege/EyeWitness): Take screenshots of website with commandline
- [pack](https://github.com/iphelix/pack.git): Password list Analysis to find patterns, to find masks, and to find rules.
- [MS Incident Response Playbook](https://learn.microsoft.com/en-us/security/operations/incident-response-playbooks)

## Tools and Commands

### Zone transfer

```
C:\> nslookup
> server dnsserver
> set type=AXFR
> ls -d targetdomain
```

```
$ dig @1.1.1.1 AXFR holidayhackchallenge.com
```

### Nmap

#### Host discovery

Ping sweeps. Solely for host discovery: `-sn` disables port scanning

```
$ sudo nmap -sn 192.168.1.1-254
```

#### Network Topology Recon

```
sudo nmap -sn --traceroute 1.1.1.1
```

#### Scan Type

- Ping sweeps: `-sn`, $ legba -U sec504 -P sec504 -T 10.10.75.1 sshOnly host discovery
- ARP scan: `-PR`, Targets only local networks
- TCP connect: `-sT`, Compelete three-way handshake. Seen by targets. Default when non-root
- TCP SYN scan: `sS`, Send SYN, never send ACK. Reciving SYNACK means OPEN, RESET means CLOSED, no response means FILTERED. Unseen by targets. Default when possible (root privilege required)
- UDP scan: `-sU`
- Versioning scan: `-sV`
- IPv6 scan: `-6`

#### Script options

**MAKE SURE USE `-sV` WHEN USING NSE SCRIPTS**. If `-sV` is not given when any of NSE script is used, nmap will assume port service based on well-known service for the port defined in nmap.services.

- `-sC`: Use default scripts
- `--script all`: Use all scripts on all ports
- `--script-updatedb`: Update NSE scripts
- `--script banner`: Get banner if the service respond within 5 seconds.
- `--script-help "SCRIPT"`: Get help for script SCRIPT
- `--script "SCRIPT*"`: Run script that starts with SCRIPT
- `--script-args`: Takes arguements for the script specified.

#### DNS bruteforce

```
$ sudo nmap --script dns-brute --script-args dns-brute.domain=holidayhackchallenge.com,dns-brute.threads=6,dns-brute.hostlist=./namelist.txt -sS -p 53
```

### massscan

[source](https://github.com/robertdavidgraham/masscan)

Extremely highspeed scanner. (Nmap is too slow for a large number of IPs). Default 100 packets/second, but can be increased up to 50000 packets/second.

```
masscan 192.168.1.1/24 -p 22,25,80,443,3389
masscan -iL us-east-1-range.txt -oL us-east-1-range.masscan -p 443 --rate 100000
```

### CeWL: Custom and Wordlist Generation

[source](https://github.com/digininja/CeWL)

```
$ sudo cewl -m 8 -w whitehouse.txt -a --meta_file whitehouse-meta.txt --email_file whitehouse-email.txt https://www.whitehouse.gov
```

### Exif tool

```
$ exiftool example.pdf
```

### FGDS: Fast Google Dorks Scan

[source](https://github.com/IvanGlinkin/Fast-Google-Dorks-Scan/)

```
./FGDS.sh sans.org
```

## TLS Certificate related tools

- [TLSScan](https://github.com/prbinu/tls-scan)
- [extract-tlsscan-hostnames.py](https://gist.github.com/joswr1ght/1a4357330557ef16d3c8d4b57ec0db33)

## Legba

[source](https://github.com/evilsocket/legba)

```
$ legba -U sec504 -P sec504 -T 10.10.75.1 ssh
$ legba -U root -P labs/10k-most-common.txt -T 172.30.0.64 mysql
```

`-U` and `-P` could be path to file or a single string to use as a username or password

## PW-Inspector

Shorten wordlist based on known password policy. Included `Legba` and `Hydra`.

```
$ pw-inspector -i /usr/share/wordlists/nmap.lst -o /root/passes.txt -m 6 -M 10
```

> pw-inspector [-i FILE] [-o FILE] [-m MINLEN] [-M MAXLEN] [-c MINSETS] -l -u -n -p -s
> -  -l: lowcase characters (a,b,c,d, etc.)
> - -u: upcase characters (A,B,C,D, etc.)
> - -n: numbers (1,2,3,4, etc.)
> - -p: printable characters (which are not -l/-n/-n, e.g. $,!,/,(,*, etc.)
> - -s: special characters - all others not withint the sets above 

## Knowledge

### NMAP Default Behavior

As root

1. ICMP Echo Request
2. TCP SYN --> TCP 443
3. TCP ACK --> TCP 80
4. ICMP Timestamp Request

As non-rootPass

1. TCP SYN --> TCP 443
2. TCP SYN --> TCP 80 (root priv required to generate ACK packets)

### Hop Limit and TTL

IPv4 TTL == IPv6 Hop Limit

```
[PC] ----(TTL-1)----> [SRV]
     <---------------
```

```
[PC] ----(TTL-1)----> [RT] ----(TTL-1)----> [SRV]
     <---------------      <---------------
```

**Packet with TTL1 or Hop Count 1 is always unreachable to any hosts except itself**. When the router receives packets TTL 1, it decrements the TTL, now TTL becomes 0, and the router sends back `ICMP TTL-Exceeded message`

### TCP Three-way handshake

ISN (Initial Sequene Number) is key to packet delivery in SEQUENTIAL ORDER.

```
    ----(  SYN  )----> 
[A] <---(SYN,ACK)----- [B]
    ----(  ACK  )---->
    <---(  DATA )---->
    <---(  DATA )---->
    <---(  DATA )---->
```

6 bits for type indentification: More than one bit can be flagged
- SYN: Synchronize
- ACK: Acknowledgement
- FIN: End a connection
- RESET: Tear down a connection
- URG: Urgent data is included
- PUSH: Data should be pushed through the TCP stack

### Nmap Aggresive Scan

`-A` equals `-O` && `-sC` && `-sV` && `--traceroute`

### List of IP addresses of huge cloud providers

#### GCP

```
wget -qO- https://www.gstatic.com/ipranges/cloud.json | jq '.prefixes[] | .ipv4Prefix' -r
```

#### AWS

```
wget -qO- https://ip-ranges.amazonaws.com/ip-ranges.json | jq '.prefixes[] | .ip_prefix' -r
```

### Credential Stuffing

**Indirect use of stolen credentials, thanks to reuse of crednetials by users**

- To crack website with credentials that are known to be valid in other system which was already compromised. Credential stuffing is to take advantage of credential reuse by user.
- IAB (Initial Access Broker) is the attackers that initially compromise systems with intention to sell valid credentails.
- Rarely disclosed to CTI (Cyber Threat Intelligence), since IAB is cautious.

### Defending against MS 365 Password spray

- Password spray only works against weak passwords: require strong passwords
- Use Microsoft Entra to monitor authentication failures.
- Use MFA to limit impact when credentials compromised